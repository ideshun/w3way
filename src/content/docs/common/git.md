---
title: "Git 笔记"
description: "Git 笔记"
---

#### 撤销提交

提交代码以后，突然意识到这个提交有问题，应该撤销掉，这时执行下面的命令就可以了。

```bash
git revert HEAD
```

`git revert` 命令只能抵消上一个提交，如果想抵消多个提交，必须在命令行依次指定这些提交。比如，抵消前两个提交，要像下面这样写。

```bash
git revert [倒数第一个提交] [倒数第二个提交]
```

`git revert` 命令还有两个参数。

- `--no-edit`：执行时不打开默认编辑器，直接使用 Git 自动生成的提交信息。
- `--no-commit`：只抵消暂存区和工作区的文件变化，不产生新的提交。

#### 替换上一次提交

提交以后，发现提交信息写错了，这时可以使用 `git commit` 命令的 `--amend` 参数，可以修改上一次的提交信息。

```bash
git commit --amend -m "Fixes bug #42"
```

#### 撤销工作区的文件修改

如果工作区的某个文件被改乱了，但还没有提交，可以用 `git checkout` 命令找回本次修改之前的文件。

```bash
git checkout -- [filename]
```

支持通配符，比如撤销全部修改。

```bash
git checkout -- *
```

它的原理是先找暂存区，如果该文件有暂存的版本，则恢复该版本，否则恢复上一次提交的版本。

注意，工作区的文件变化一旦被撤销，就无法找回了。

#### 从暂存区撤销文件

如果不小心把一个文件添加到暂存区，可以用下面的命令撤销。

```bash
git rm --cached [filename]
```

#### 撤销当前分支的变化

你在当前分支上做了几次提交，突然发现放错了分支，这几个提交本应该放到另一个分支。

```bash
# 新建一个 feature 分支，指向当前最新的提交
# 注意，这时依然停留在当前分支
git branch feature

# 切换到这几次提交之前的状态
git reset --hard [当前分支此前的最后一次提交]

# 切换到 feature 分支
git checkout feature
```